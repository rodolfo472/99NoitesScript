<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Block Pro</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  background:#121212;
  color:#fff;
  font-family:Arial,sans-serif;
  text-align:center;
}

header{
  background:#1f1f1f;
  padding:14px;
  font-size:22px;
  font-weight:bold;
  letter-spacing:1px;
}

#info{
  display:flex;
  justify-content:space-around;
  padding:10px;
  font-size:16px;
}

#board{
  width:320px;
  height:320px;
  margin:10px auto;
  display:grid;
  grid-template-columns:repeat(8,1fr);
  grid-template-rows:repeat(8,1fr);
  gap:3px;
  background:#2a2a2a;
  padding:6px;
  border-radius:14px;
}

.cell{
  background:#1c1c1c;
  border-radius:6px;
}

.filled{
  background:linear-gradient(145deg,#4ade80,#22c55e);
  box-shadow:0 0 6px rgba(34,197,94,.7);
}

#tray{
  display:flex;
  justify-content:center;
  gap:14px;
  margin:18px 0;
}

.shape{
  display:grid;
  gap:3px;
  touch-action:none;
}

.block{
  width:28px;
  height:28px;
  border-radius:6px;
  background:linear-gradient(145deg,#4ade80,#22c55e);
  box-shadow:0 0 6px rgba(34,197,94,.8);
}

#gameOver{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.85);
  display:none;
  align-items:center;
  justify-content:center;
  font-size:32px;
  font-weight:bold;
  color:#f87171;
  z-index:10;
}
</style>
</head>

<body>

<header>ðŸŸ© Block Pro</header>

<div id="info">
  <div>Pontos: <span id="score">0</span></div>
  <div>Recorde: <span id="record">0</span></div>
</div>

<div id="board"></div>
<div id="tray"></div>

<div id="gameOver">GAME OVER</div>

<audio id="placeSound">
  <source src="data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAESsAACJWAAACABAAZGF0YQAAAAA=">
</audio>

<script>
const boardEl=document.getElementById("board");
const trayEl=document.getElementById("tray");
const scoreEl=document.getElementById("score");
const recordEl=document.getElementById("record");
const gameOverEl=document.getElementById("gameOver");
const sound=document.getElementById("placeSound");

let board=Array(64).fill(0);
let score=0;
let record=Number(localStorage.getItem("record_blockpro"))||0;
recordEl.innerText=record;

// ===== TABULEIRO
function drawBoard(){
  boardEl.innerHTML="";
  board.forEach(v=>{
    const d=document.createElement("div");
    d.className="cell"+(v?" filled":"");
    boardEl.appendChild(d);
  });
}

// ===== FORMAS
const shapes=[
  [[1]],
  [[1,1]],
  [[1],[1]],
  [[1,1,1]],
  [[1],[1],[1]],
  [[1,1],[1,1]]
];

// ===== CRIAR BLOCO
function createShape(){
  const s=shapes[Math.floor(Math.random()*shapes.length)];
  const el=document.createElement("div");
  el.className="shape";
  el.shape=s;
  el.style.gridTemplateColumns=`repeat(${s[0].length},28px)`;
  s.flat().forEach(c=>{
    const b=document.createElement("div");
    b.className="block";
    el.appendChild(b);
  });
  trayEl.appendChild(el);
  drag(el);
}

// ===== GERAR 3
function refillTray(){
  trayEl.innerHTML="";
  for(let i=0;i<3;i++) createShape();
}

// ===== DRAG
function drag(el){
  let ox,oy;
  el.onpointerdown=e=>{
    ox=e.offsetX;
    oy=e.offsetY;
    el.setPointerCapture(e.pointerId);
    el.style.position="absolute";
  };
  el.onpointermove=e=>{
    el.style.left=e.pageX-ox+"px";
    el.style.top=e.pageY-oy+"px";
  };
  el.onpointerup=e=>{
    el.releasePointerCapture(e.pointerId);
    const r=boardEl.getBoundingClientRect();
    if(e.pageX>r.left&&e.pageX<r.right&&e.pageY>r.top&&e.pageY<r.bottom){
      const c=Math.floor((e.pageX-r.left)/40);
      const l=Math.floor((e.pageY-r.top)/40);
      const i=l*8+c;
      if(place(el.shape,i)){
        el.remove();
        sound.currentTime=0;
        sound.play();
        score+=10;
        scoreEl.innerText=score;
        if(trayEl.children.length===0) setTimeout(refillTray,300);
        checkGameOver();
        return;
      }
    }
    el.style.position="static";
  };
}

// ===== COLOCAR
function place(s,i){
  const w=s[0].length;
  for(let r=0;r<s.length;r++)
    for(let c=0;c<w;c++)
      if(s[r][c]&&(i+r*8+c>=64||board[i+r*8+c])) return false;

  for(let r=0;r<s.length;r++)
    for(let c=0;c<w;c++)
      if(s[r][c]) board[i+r*8+c]=1;

  drawBoard();
  return true;
}

// ===== GAME OVER
function checkGameOver(){
  const ok=[...trayEl.children].some(el=>{
    for(let i=0;i<64;i++)
      if(place(el.shape,i)){
        board=board.map(()=>0);
        drawBoard();
        return true;
      }
    return false;
  });

  if(!ok){
    gameOverEl.style.display="flex";
    if(score>record){
      record=score;
      localStorage.setItem("record_blockpro",record);
      recordEl.innerText=record;
    }
    setTimeout(resetGame,2000);
  }
}

// ===== RESET
function resetGame(){
  gameOverEl.style.display="none";
  board=Array(64).fill(0);
  score=0;
  scoreEl.innerText=0;
  drawBoard();
  refillTray();
}

// START
drawBoard();
refillTray();
</script>

</body>
</html>
